\hypertarget{structinstance}{}\doxysection{instance Struct Reference}
\label{structinstance}\index{instance@{instance}}


The \textquotesingle{}instance\textquotesingle{} type which needs to be standard layout (need to be able to use \textquotesingle{}offsetof\textquotesingle{})  




{\ttfamily \#include $<$common.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{structinstance_addb02b48487bafc757c28d40d1d6a995}{allocate\+\_\+layout}} ()
\item 
\Hypertarget{structinstance_a0e6db8a0edd9f4d440a4b31fb1f59d19}\label{structinstance_a0e6db8a0edd9f4d440a4b31fb1f59d19} 
void {\bfseries deallocate\+\_\+layout} ()
\begin{DoxyCompactList}\small\item\em Destroys/deallocates all of the above. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structvalue__and__holder}{value\+\_\+and\+\_\+holder}} \mbox{\hyperlink{structinstance_a33fb0acd9a08898baf6dfefc54477821}{get\+\_\+value\+\_\+and\+\_\+holder}} (const \mbox{\hyperlink{structtype__info}{type\+\_\+info}} $\ast$find\+\_\+type=nullptr, bool throw\+\_\+if\+\_\+missing=true)
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{structinstance_aafabccc03d3d2afd3ab7e1a1b01b7a56}\label{structinstance_aafabccc03d3d2afd3ab7e1a1b01b7a56} 
\begin{tabbing}
xx\=xx\=xx\=xx\=xx\=xx\=xx\=xx\=xx\=\kill
union \{\\
\>void $\ast$ {\bfseries simple\_value\_holder} \mbox{[}1+instance\_simple\_holder\_in\_ptrs()\mbox{]}\\
\>\mbox{\hyperlink{structnonsimple__values__and__holders}{nonsimple\_values\_and\_holders}} {\bfseries nonsimple}\\
\}; \\

\end{tabbing}\begin{DoxyCompactList}\small\item\em Storage for pointers and holder; see simple\+\_\+layout, below, for a description. \end{DoxyCompactList}\item 
\Hypertarget{structinstance_a23dd4c6144dbfa8ed0ba6d2a7a964998}\label{structinstance_a23dd4c6144dbfa8ed0ba6d2a7a964998} 
Py\+Object $\ast$ {\bfseries weakrefs}
\begin{DoxyCompactList}\small\item\em Weak references. \end{DoxyCompactList}\item 
\Hypertarget{structinstance_a69b3e638c182ecbbaaa5625ce3c36e99}\label{structinstance_a69b3e638c182ecbbaaa5625ce3c36e99} 
bool {\bfseries owned}\+: 1
\begin{DoxyCompactList}\small\item\em If true, the pointer is owned which means we\textquotesingle{}re free to manage it with a holder. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{structinstance_a1e23897fd281cdd5cecd2d36b5d7a26d}{simple\+\_\+layout}}\+: 1
\item 
\Hypertarget{structinstance_a70b19567d7738df6679e1599e7d3ff75}\label{structinstance_a70b19567d7738df6679e1599e7d3ff75} 
bool {\bfseries simple\+\_\+holder\+\_\+constructed}\+: 1
\begin{DoxyCompactList}\small\item\em For simple layout, tracks whether the holder has been constructed. \end{DoxyCompactList}\item 
\Hypertarget{structinstance_a464df414f8c21853c43be0ab4ccf8e93}\label{structinstance_a464df414f8c21853c43be0ab4ccf8e93} 
bool {\bfseries simple\+\_\+instance\+\_\+registered}\+: 1
\begin{DoxyCompactList}\small\item\em For simple layout, tracks whether the instance is registered in {\ttfamily registered\+\_\+instances} \end{DoxyCompactList}\item 
\Hypertarget{structinstance_a30d2da1bf481e5628e3f20a84a4bcd1a}\label{structinstance_a30d2da1bf481e5628e3f20a84a4bcd1a} 
bool {\bfseries has\+\_\+patients}\+: 1
\begin{DoxyCompactList}\small\item\em If true, get\+\_\+internals().patients has an entry for this object. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{structinstance_a2d8ccf4b4d7dcb8083cee8cc030ec871}\label{structinstance_a2d8ccf4b4d7dcb8083cee8cc030ec871} 
static constexpr uint8\+\_\+t {\bfseries status\+\_\+holder\+\_\+constructed} = 1
\begin{DoxyCompactList}\small\item\em Bit values for the non-\/simple status flags. \end{DoxyCompactList}\item 
\Hypertarget{structinstance_a48612cbb682f9b16cbaeba60f1bca052}\label{structinstance_a48612cbb682f9b16cbaeba60f1bca052} 
static constexpr uint8\+\_\+t {\bfseries status\+\_\+instance\+\_\+registered} = 2
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The \textquotesingle{}instance\textquotesingle{} type which needs to be standard layout (need to be able to use \textquotesingle{}offsetof\textquotesingle{}) 

\doxysubsection{Member Function Documentation}
\Hypertarget{structinstance_addb02b48487bafc757c28d40d1d6a995}\label{structinstance_addb02b48487bafc757c28d40d1d6a995} 
\index{instance@{instance}!allocate\_layout@{allocate\_layout}}
\index{allocate\_layout@{allocate\_layout}!instance@{instance}}
\doxysubsubsection{\texorpdfstring{allocate\_layout()}{allocate\_layout()}}
{\footnotesize\ttfamily PYBIND11\+\_\+\+NOINLINE void instance\+::allocate\+\_\+layout (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Initializes all of the above type/values/holders data (but not the instance values themselves) \Hypertarget{structinstance_a33fb0acd9a08898baf6dfefc54477821}\label{structinstance_a33fb0acd9a08898baf6dfefc54477821} 
\index{instance@{instance}!get\_value\_and\_holder@{get\_value\_and\_holder}}
\index{get\_value\_and\_holder@{get\_value\_and\_holder}!instance@{instance}}
\doxysubsubsection{\texorpdfstring{get\_value\_and\_holder()}{get\_value\_and\_holder()}}
{\footnotesize\ttfamily PYBIND11\+\_\+\+NOINLINE \mbox{\hyperlink{structvalue__and__holder}{value\+\_\+and\+\_\+holder}} instance\+::get\+\_\+value\+\_\+and\+\_\+holder (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structtype__info}{type\+\_\+info}} $\ast$}]{find\+\_\+type = {\ttfamily nullptr},  }\item[{bool}]{throw\+\_\+if\+\_\+missing = {\ttfamily true} }\end{DoxyParamCaption})}

Returns the \doxylink{structvalue__and__holder}{value\+\_\+and\+\_\+holder} wrapper for the given type (or the first, if {\ttfamily find\+\_\+type} omitted). Returns a default-\/constructed (with {\ttfamily .inst = nullptr}) object on failure if {\ttfamily throw\+\_\+if\+\_\+missing} is false.

Extracts C++ value and holder pointer references from an instance (which may contain multiple values/holders for python-\/side multiple inheritance) that match the given type. Throws an error if the given type (or Value\+Type, if omitted) is not a pybind11 base of the given instance. If {\ttfamily find\+\_\+type} is omitted (or explicitly specified as nullptr) the first value/holder are returned, regardless of type (and the resulting .type will be nullptr).

The returned object should be short-\/lived\+: in particular, it must not outlive the called-\/upon instance. 

\doxysubsection{Member Data Documentation}
\Hypertarget{structinstance_a1e23897fd281cdd5cecd2d36b5d7a26d}\label{structinstance_a1e23897fd281cdd5cecd2d36b5d7a26d} 
\index{instance@{instance}!simple\_layout@{simple\_layout}}
\index{simple\_layout@{simple\_layout}!instance@{instance}}
\doxysubsubsection{\texorpdfstring{simple\_layout}{simple\_layout}}
{\footnotesize\ttfamily bool instance\+::simple\+\_\+layout}

An instance has two possible value/holder layouts.

Simple layout (when this flag is true), means the {\ttfamily simple\+\_\+value\+\_\+holder} is set with a pointer and the holder object governing that pointer, i.\+e. \mbox{[}val1$\ast$\mbox{]}\mbox{[}holder\mbox{]}. This layout is applied whenever there is no python-\/side multiple inheritance of bound C++ types {\itshape and} the type\textquotesingle{}s holder will fit in the default space (which is large enough to hold either a std\+::unique\+\_\+ptr or std\+::shared\+\_\+ptr).

Non-\/simple layout applies when using custom holders that require more space than {\ttfamily shared\+\_\+ptr} (which is typically the size of two pointers), or when multiple inheritance is used on the python side. Non-\/simple layout allocates the required amount of memory to have multiple bound C++ classes as parents. Under this layout, {\ttfamily nonsimple.\+values\+\_\+and\+\_\+holders} is set to a pointer to allocated space of the required space to hold a sequence of value pointers and holders followed {\ttfamily status}, a set of bit flags (1 byte each), i.\+e. \mbox{[}val1$\ast$\mbox{]}\mbox{[}holder1\mbox{]}\mbox{[}val2$\ast$\mbox{]}\mbox{[}holder2\mbox{]}...\mbox{[}bb...\mbox{]} where each \mbox{[}block\mbox{]} is rounded up to a multiple of {\ttfamily sizeof(void $\ast$)}. {\ttfamily nonsimple.\+status} is, for convenience, a pointer to the beginning of the \mbox{[}bb...\mbox{]} block (but not independently allocated).

Status bits indicate whether the associated holder is constructed (\& status\+\_\+holder\+\_\+constructed) and whether the value pointer is registered (\& status\+\_\+instance\+\_\+registered) in {\ttfamily registered\+\_\+instances}. 

The documentation for this struct was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
bindings/python/pybind11/include/pybind11/detail/common.\+h\item 
type\+\_\+caster\+\_\+base.\+h\end{DoxyCompactItemize}
