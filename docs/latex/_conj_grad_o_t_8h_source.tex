\hypertarget{_conj_grad_o_t_8h_source}{}\doxysection{Conj\+Grad\+OT.\+h}
\label{_conj_grad_o_t_8h_source}\index{ConjGradOT.h@{ConjGradOT.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ ====CONJGRADOT.H\ ==========================================================================}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Author:\ Patrice\ Koehl\ (in\ collaboration\ with\ Henri\ Orland),\ November\ 2018}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ Department\ of\ Computer\ Science}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ University\ of\ California,\ Davis}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ This\ file\ implements\ a\ conjugate\ gradient\ method\ for\ soling\ a\ linear\ system\ of\ equation\ with}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ preconditioner}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ It\ is\ based\ on\ cg\_rc.cpp\ from\ John\ Burkardt\ }}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *\ (https://people.sc.fsu.edu/\string~jburkardt/cpp\_src/cg\_rc/cg\_rc\_prb.cpp)}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ ===============================================================================================\ */}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#ifndef\ \_CONJGRADOT\_H\_}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ \_CONJGRADOT\_H\_}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\ \ \#include\ <cmath>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\ \ \#include\ <algorithm>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\ \ \#include\ <functional>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\ \ \#include\ <cstdlib>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ \ \ prototypes\ for\ BLAS\ and\ LAPACK\ functions\ }}
\DoxyCodeLine{00025\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{comment}{//\ BLAS1:\ copy\ one\ vector\ into\ another}}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{void}\ dcopy\_(\textcolor{keywordtype}{int}\ *\ n,\ \textcolor{keywordtype}{double}\ *\ X,\ \textcolor{keywordtype}{int}\ *incx,\ \textcolor{keywordtype}{double}\ *\ Y,\ \textcolor{keywordtype}{int}\ *incy);}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{comment}{//\ BLAS1:\ dot\ product\ of\ two\ vectors\ \ \ \ }}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordtype}{double}\ ddot\_(\textcolor{keywordtype}{int}\ *\ n,\ \textcolor{keywordtype}{double}\ *\ u,\ \textcolor{keywordtype}{int}\ *\ incu,\ \textcolor{keywordtype}{double}\ *\ v,\ \textcolor{keywordtype}{int}\ *incv);}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{comment}{//\ BLAS1:\ norm\ of\ a\ vector}}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordtype}{double}\ dnrm2\_(\textcolor{keywordtype}{int}\ *\ n,\ \textcolor{keywordtype}{double}\ *\ X,\ \textcolor{keywordtype}{int}\ *incx);}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{//\ BLAS1:\ Y\ <-\/\ alpha*X\ +\ Y}}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordtype}{void}\ daxpy\_(\ \textcolor{keywordtype}{int}\ *\ n,\ \textcolor{keywordtype}{double}\ *alpha,\ \textcolor{keywordtype}{double}\ *X,\ \textcolor{keywordtype}{int}\ *incx,\ \textcolor{keywordtype}{double}\ *Y,\ \textcolor{keywordtype}{int}\ *incy);}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{comment}{//\ BLAS2:\ perform\ Y\ :=\ alpha*op(\ A\ )*\ B\ \ +\ beta*Y}}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordtype}{void}\ dgemv\_(\textcolor{keywordtype}{char}\ *\ trans,\ \textcolor{keywordtype}{int}\ *\ m,\ \textcolor{keywordtype}{int}\ *\ n,\ \textcolor{keywordtype}{double}\ *\ alpha,\ \textcolor{keywordtype}{double}\ *A,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ *lda,\ \textcolor{keywordtype}{double}\ *\ X,\ \textcolor{keywordtype}{int}\ *\ incx,\ \textcolor{keywordtype}{double}\ *beta,\ \textcolor{keywordtype}{double}\ *\ Y,\ \textcolor{keywordtype}{int}\ *\ incy);}
\DoxyCodeLine{00039\ \ \ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00042\ \textcolor{comment}{\ \ \ Define\ the\ conjgrad\ class\ for\ OT}}
\DoxyCodeLine{00043\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_conj_grad_o_t}{ConjGradOT}}\{}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ driver\ function\ for\ conjugate\ gradient\ minimizer}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{int}\ cgDriver(\textcolor{keywordtype}{int}\ n1,\ \textcolor{keywordtype}{int}\ n2,\ \textcolor{keywordtype}{double}\ *D1,\ \textcolor{keywordtype}{double}\ *D2,\ \textcolor{keywordtype}{double}\ *G,\ \textcolor{keywordtype}{double}\ *B,\ \textcolor{keywordtype}{double}\ *X,}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ *r,\ \textcolor{keywordtype}{double}\ *z,\ \textcolor{keywordtype}{double}\ *p,\ \textcolor{keywordtype}{double}\ *q,\ \textcolor{keywordtype}{double}\ *Temp,\ \textcolor{keywordtype}{double}\ *Temp2,\ \textcolor{keywordtype}{double}\ tol);}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ compute\ Y\ =\ A\ X}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ computeMatVect(\textcolor{keywordtype}{int}\ n1,\ \textcolor{keywordtype}{int}\ n2,\ \textcolor{keywordtype}{double}\ *D1,\ \textcolor{keywordtype}{double}\ *D2,\ \textcolor{keywordtype}{double}\ *G,\ \textcolor{keywordtype}{double}\ *X,\ \textcolor{keywordtype}{double}\ *Y,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ *Temp);}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ apply\ preconditioner}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{void}\ preConditioner(\textcolor{keywordtype}{int}\ n1,\ \textcolor{keywordtype}{int}\ n2,\ \textcolor{keywordtype}{double}\ *D1,\ \textcolor{keywordtype}{double}\ *D2,\ \textcolor{keywordtype}{double}\ *G,\ \textcolor{keywordtype}{double}\ *B,\ \textcolor{keywordtype}{double}\ *X,\ \textcolor{keywordtype}{double}\ *wrk);}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ conjgrad\ routine\ with\ reverse\ communication}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{int}\ cgRC(\ \textcolor{keywordtype}{int}\ n,\ \textcolor{keywordtype}{double}\ *b,\ \textcolor{keywordtype}{double}\ *x,\ \textcolor{keywordtype}{double}\ *r,\ \textcolor{keywordtype}{double}\ *z,\ \textcolor{keywordtype}{double}\ *p,\ \textcolor{keywordtype}{double}\ *q,\ \textcolor{keywordtype}{int}\ job\ );}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{comment}{//\ Internal\ variables\ for\ conjgrad}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{int}\ rlbl,\ iter;}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{double}\ rho,\ rho\_old;}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \};}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00072\ \textcolor{comment}{\ \ \ Compute\ Y\ =\ A*X}}
\DoxyCodeLine{00073\ \textcolor{comment}{\ \ \ where\ A\ is\ of\ the\ form:}}
\DoxyCodeLine{00074\ \textcolor{comment}{}}
\DoxyCodeLine{00075\ \textcolor{comment}{\ \ \ \ A\ =\ [\ D1\ \ \ \ G\ ]}}
\DoxyCodeLine{00076\ \textcolor{comment}{\ \ \ \ \ \ \ \ [\ G\string^T\ \ \ D2\ ]}}
\DoxyCodeLine{00077\ \textcolor{comment}{}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ \ \ \ with\ D1\ a\ n1xn1\ diagonal\ matrix,\ G\ a\ n1xn2\ matrix,\ and\ D2\ a\ n2xn2\ diagonal\ matrix}}
\DoxyCodeLine{00079\ \textcolor{comment}{}}
\DoxyCodeLine{00080\ \textcolor{comment}{\ \ \ \ Temp\ is\ a\ work\ space\ array}}
\DoxyCodeLine{00081\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{keywordtype}{void}\ ConjGradOT::computeMatVect(\textcolor{keywordtype}{int}\ n1,\ \textcolor{keywordtype}{int}\ n2,\ \textcolor{keywordtype}{double}\ *D1,\ \textcolor{keywordtype}{double}\ *D2,\ \textcolor{keywordtype}{double}\ *G,\ \textcolor{keywordtype}{double}\ *X,\ \textcolor{keywordtype}{double}\ *Y,}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ *Temp)}
\DoxyCodeLine{00085\ \ \ \{}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{int}\ inc\ =\ 1;}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{double}\ a,\ b;}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{char}\ Trans\ \ \ =\ \textcolor{charliteral}{'T'};}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{char}\ NoTrans\ =\ \textcolor{charliteral}{'N'};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ a\ =\ 1;\ b\ =\ 0;}
\DoxyCodeLine{00094\ \ \ \ \ dgemv\_(\&NoTrans,\ \&n1,\ \&n2,\ \&a,\ G,\ \&n1,\ \&X[n1],\ \&inc,\ \&b,\ Temp,\ \&inc);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n1;\ i++)}
\DoxyCodeLine{00097\ \ \ \ \ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ Y[i]\ =\ D1[i]*X[i]\ +\ Temp[i];}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ dgemv\_(\&Trans,\ \&n1,\ \&n2,\ \&a,\ G,\ \&n1,\ X,\ \&inc,\ \&b,\ Temp,\ \&inc);}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n2;\ i++)}
\DoxyCodeLine{00104\ \ \ \ \ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ Y[i+n1]\ =\ D2[i]*X[i+n1]\ +\ Temp[i];}
\DoxyCodeLine{00106\ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00110\ \textcolor{comment}{\ \ \ Precond}}
\DoxyCodeLine{00111\ \textcolor{comment}{}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ \ \ Solve\ }}
\DoxyCodeLine{00113\ \textcolor{comment}{\ \ \ \ M\ X\ =\ B}}
\DoxyCodeLine{00114\ \textcolor{comment}{\ \ \ where\ M\ is\ the\ chosen\ preconditionner}}
\DoxyCodeLine{00115\ \textcolor{comment}{}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ \ \ Input:}}
\DoxyCodeLine{00117\ \textcolor{comment}{\ \ \ =====}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ \ \ \ n1:\ number\ of\ points\ for\ point\ set\ 1}}
\DoxyCodeLine{00119\ \textcolor{comment}{\ \ \ \ n2:\ number\ of\ points\ for\ point\ set\ 2}}
\DoxyCodeLine{00120\ \textcolor{comment}{\ \ \ \ D1:\ first\ diagonal\ matrix\ (see\ above)}}
\DoxyCodeLine{00121\ \textcolor{comment}{\ \ \ \ D2:\ second\ diagonal\ matrix\ (see\ above)}}
\DoxyCodeLine{00122\ \textcolor{comment}{\ \ \ \ G:\ \ upper\ matrix\ (see\ above)}}
\DoxyCodeLine{00123\ \textcolor{comment}{}}
\DoxyCodeLine{00124\ \textcolor{comment}{\ \ \ M\ =\ [\ I\ \ \ \ \ \ \ \ \ \ \ \ \ 0\ ]\ [\ D1\ \ \ 0\ ]\ [\ I\ \ \ D1\string^\{-\/1\}\ G\ ]}}
\DoxyCodeLine{00125\ \textcolor{comment}{\ \ \ \ \ \ \ [\ G\string^T\ D1\string^\{-\/1\}\ \ \ I\ ]\ [\ 0\ \ \ D2\ ]\ [\ 0\ \ \ \ \ \ \ \ \ \ \ I\ ]}}
\DoxyCodeLine{00126\ \textcolor{comment}{\ \ \ \ }}
\DoxyCodeLine{00127\ \textcolor{comment}{\ \ \ Output:}}
\DoxyCodeLine{00128\ \textcolor{comment}{\ \ \ ======}}
\DoxyCodeLine{00129\ \textcolor{comment}{\ \ \ \ dX:\ \ \ \ \ updates\ on\ lambda}}
\DoxyCodeLine{00130\ \textcolor{comment}{\ \ \ \ dm:\ \ \ \ \ updates\ on\ mu}}
\DoxyCodeLine{00131\ \textcolor{comment}{}}
\DoxyCodeLine{00132\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{keywordtype}{void}\ ConjGradOT::preConditioner(\textcolor{keywordtype}{int}\ n1,\ \textcolor{keywordtype}{int}\ n2,\ \textcolor{keywordtype}{double}\ *D1,\ \textcolor{keywordtype}{double}\ *D2,\ \textcolor{keywordtype}{double}\ *G,\ \textcolor{keywordtype}{double}\ *B,\ \textcolor{keywordtype}{double}\ *X,\ \textcolor{keywordtype}{double}\ *wrk)}
\DoxyCodeLine{00135\ \ \ \{}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{int}\ inc\ =\ 1;}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{double}\ a,\ b;}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{char}\ Trans\ \ \ =\ \textcolor{charliteral}{'T'};}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{char}\ NoTrans\ =\ \textcolor{charliteral}{'N'};}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n1;\ i++)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ wrk[i]\ =\ B[i]\ /\ D1[i];}
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ \ \ \ \ a\ =\ 1;\ b\ =\ 0;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ dgemv\_(\&Trans,\ \&n1,\ \&n2,\ \&a,\ G,\ \&n1,\ wrk,\ \&inc,\ \&b,\ \&wrk[n1],\ \&inc);}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n2;\ i++)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ X[i+n1]\ =\ (B[i+n1]-\/wrk[i+n1])/D2[i];}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ dgemv\_(\&NoTrans,\ \&n1,\ \&n2,\ \&a,\ G,\ \&n1,\ \&X[n1],\ \&inc,\ \&b,\ wrk,\ \&inc);}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n1;\ i++)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ X[i]\ =\ (B[i]\ -\/\ wrk[i])\ /\ D1[i];}
\DoxyCodeLine{00155\ \ \ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \textcolor{comment}{/*}}
\DoxyCodeLine{00158\ \textcolor{comment}{\ \ \ \ for(int\ i\ =\ 0;\ i\ <\ n1;\ i++)\ \{}}
\DoxyCodeLine{00159\ \textcolor{comment}{\ \ \ \ \ \ \ \ X[i]\ =\ B[i]\ /\ D1[i];}}
\DoxyCodeLine{00160\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00161\ \textcolor{comment}{\ \ \ \ for(int\ i\ =\ 0;\ i\ <\ n2;\ i++)\ \{}}
\DoxyCodeLine{00162\ \textcolor{comment}{\ \ \ \ \ \ \ \ X[i+n1]\ =\ B[i+n1]\ /\ D2[i];}}
\DoxyCodeLine{00163\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00164\ \textcolor{comment}{}}
\DoxyCodeLine{00165\ \textcolor{comment}{\ \ \ \ for(int\ i\ =\ 0;\ i<n1+n2;\ i++)\ \{}}
\DoxyCodeLine{00166\ \textcolor{comment}{\ \ \ \ \ \ \ \ X[i]\ =\ B[i];}}
\DoxyCodeLine{00167\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00168\ \textcolor{comment}{*/}}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00171\ \textcolor{comment}{\ \ \ Conjugate\ gradient\ with\ reverse\ communication}}
\DoxyCodeLine{00172\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \textcolor{keywordtype}{int}\ ConjGradOT::cgRC(\ \textcolor{keywordtype}{int}\ n,\ \textcolor{keywordtype}{double}\ *b,\ \textcolor{keywordtype}{double}\ *x,\ \textcolor{keywordtype}{double}\ *r,\ \textcolor{keywordtype}{double}\ *z,\ \textcolor{keywordtype}{double}\ *p,\ \textcolor{keywordtype}{double}\ *q,\ \textcolor{keywordtype}{int}\ job\ )}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00177\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00178\ \textcolor{comment}{*\ \ \ Purpose:}}
\DoxyCodeLine{00179\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00180\ \textcolor{comment}{*\ \ \ \ \ CG\_RC\ is\ a\ reverse\ communication\ conjugate\ gradient\ routine.}}
\DoxyCodeLine{00181\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00182\ \textcolor{comment}{*\ \ \ Discussion:}}
\DoxyCodeLine{00183\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00184\ \textcolor{comment}{*\ \ \ \ \ This\ routine\ seeks\ a\ solution\ of\ the\ linear\ system\ A*x=b}}
\DoxyCodeLine{00185\ \textcolor{comment}{*\ \ \ \ \ where\ b\ is\ a\ given\ right\ hand\ side\ vector,\ A\ is\ an\ n\ by\ n}}
\DoxyCodeLine{00186\ \textcolor{comment}{*\ \ \ \ \ symmetric\ positive\ definite\ matrix,\ and\ x\ is\ an\ unknown\ vector}}
\DoxyCodeLine{00187\ \textcolor{comment}{*\ \ \ \ \ to\ be\ determined.}}
\DoxyCodeLine{00188\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00189\ \textcolor{comment}{*\ \ \ \ \ Under\ the\ assumptions\ that\ the\ matrix\ A\ is\ large\ and\ sparse,}}
\DoxyCodeLine{00190\ \textcolor{comment}{*\ \ \ \ \ the\ conjugate\ gradient\ method\ may\ provide\ a\ solution\ when}}
\DoxyCodeLine{00191\ \textcolor{comment}{*\ \ \ \ \ a\ direct\ approach\ would\ be\ impractical\ because\ of\ excessive}}
\DoxyCodeLine{00192\ \textcolor{comment}{*\ \ \ \ \ requirements\ of\ storage\ or\ even\ of\ time.}}
\DoxyCodeLine{00193\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00194\ \textcolor{comment}{*\ \ \ \ \ The\ conjugate\ gradient\ method\ presented\ here\ does\ not\ require\ the\ }}
\DoxyCodeLine{00195\ \textcolor{comment}{*\ \ \ \ \ user\ to\ store\ the\ matrix\ A\ in\ a\ particular\ way.\ \ Instead,\ it\ only\ }}
\DoxyCodeLine{00196\ \textcolor{comment}{*\ \ \ \ \ supposes\ that\ the\ user\ has\ a\ way\ of\ calculating}}
\DoxyCodeLine{00197\ \textcolor{comment}{*\ \ \ \ \ \ \ y\ =\ alpha\ *\ A\ *\ x\ +\ b\ *\ y}}
\DoxyCodeLine{00198\ \textcolor{comment}{*\ \ \ \ \ and\ of\ solving\ the\ preconditioned\ linear\ system}}
\DoxyCodeLine{00199\ \textcolor{comment}{*\ \ \ \ \ \ \ M\ *\ x\ =\ b}}
\DoxyCodeLine{00200\ \textcolor{comment}{*\ \ \ \ \ where\ M\ is\ some\ preconditioning\ matrix,\ which\ might\ be\ merely}}
\DoxyCodeLine{00201\ \textcolor{comment}{*\ \ \ \ \ the\ identity\ matrix,\ or\ a\ diagonal\ matrix\ containing\ the}}
\DoxyCodeLine{00202\ \textcolor{comment}{*\ \ \ \ \ diagonal\ entries\ of\ A.}}
\DoxyCodeLine{00203\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00204\ \textcolor{comment}{*\ \ \ \ \ This\ routine\ was\ extracted\ from\ the\ "{}templates"{}\ package.}}
\DoxyCodeLine{00205\ \textcolor{comment}{*\ \ \ \ \ There,\ it\ was\ not\ intended\ for\ direct\ access\ by\ a\ user;}}
\DoxyCodeLine{00206\ \textcolor{comment}{*\ \ \ \ \ instead,\ a\ higher\ routine\ called\ "{}cg()"{}\ was\ called\ once\ by}}
\DoxyCodeLine{00207\ \textcolor{comment}{*\ \ \ \ \ the\ user.\ \ The\ cg()\ routine\ then\ made\ repeated\ calls\ to\ }}
\DoxyCodeLine{00208\ \textcolor{comment}{*\ \ \ \ \ cgrevcom()\ before\ returning\ the\ result\ to\ the\ user.}}
\DoxyCodeLine{00209\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00210\ \textcolor{comment}{*\ \ \ \ \ The\ reverse\ communication\ feature\ of\ cgrevcom()\ makes\ it,\ by\ itself,}}
\DoxyCodeLine{00211\ \textcolor{comment}{*\ \ \ \ \ a\ very\ powerful\ function.\ \ It\ allows\ the\ user\ to\ handle\ issues\ of}}
\DoxyCodeLine{00212\ \textcolor{comment}{*\ \ \ \ \ storage\ and\ implementation\ that\ would\ otherwise\ have\ to\ be}}
\DoxyCodeLine{00213\ \textcolor{comment}{*\ \ \ \ \ mediated\ in\ a\ fixed\ way\ by\ the\ function\ argument\ list.\ \ Therefore,}}
\DoxyCodeLine{00214\ \textcolor{comment}{*\ \ \ \ \ this\ version\ of\ cgrecom()\ has\ been\ extracted\ from\ the\ templates}}
\DoxyCodeLine{00215\ \textcolor{comment}{*\ \ \ \ \ library\ and\ documented\ as\ a\ stand-\/alone\ procedure.}}
\DoxyCodeLine{00216\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00217\ \textcolor{comment}{*\ \ \ \ \ The\ user\ sets\ the\ value\ of\ JOB\ to\ 1\ before\ the\ first\ call,}}
\DoxyCodeLine{00218\ \textcolor{comment}{*\ \ \ \ \ indicating\ the\ beginning\ of\ the\ computation,\ and\ to\ the\ value\ of}}
\DoxyCodeLine{00219\ \textcolor{comment}{*\ \ \ \ \ 2\ thereafter,\ indicating\ a\ continuation\ call.\ \ }}
\DoxyCodeLine{00220\ \textcolor{comment}{*\ \ \ \ \ The\ output\ value\ of\ JOB\ is\ set\ by\ cgrevcom(),\ which}}
\DoxyCodeLine{00221\ \textcolor{comment}{*\ \ \ \ \ will\ return\ with\ an\ output\ value\ of\ JOB\ that\ requests\ a\ particular}}
\DoxyCodeLine{00222\ \textcolor{comment}{*\ \ \ \ \ new\ action\ from\ the\ user.}}
\DoxyCodeLine{00223\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00224\ \textcolor{comment}{*\ \ \ Licensing:}}
\DoxyCodeLine{00225\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00226\ \textcolor{comment}{*\ \ \ \ \ This\ code\ is\ distributed\ under\ the\ GNU\ LGPL\ license.}}
\DoxyCodeLine{00227\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00228\ \textcolor{comment}{*\ \ \ Modified:}}
\DoxyCodeLine{00229\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00230\ \textcolor{comment}{*\ \ \ \ \ 13\ January\ 2013}}
\DoxyCodeLine{00231\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00232\ \textcolor{comment}{*\ \ \ Author:}}
\DoxyCodeLine{00233\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00234\ \textcolor{comment}{*\ \ \ \ \ John\ Burkardt}}
\DoxyCodeLine{00235\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00236\ \textcolor{comment}{*\ \ \ Reference:}}
\DoxyCodeLine{00237\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00238\ \textcolor{comment}{*\ \ \ \ \ Richard\ Barrett,\ Michael\ Berry,\ Tony\ Chan,\ James\ Demmel,}}
\DoxyCodeLine{00239\ \textcolor{comment}{*\ \ \ \ \ June\ Donato,\ Jack\ Dongarra,\ Victor\ Eijkhout,\ Roidan\ Pozo,}}
\DoxyCodeLine{00240\ \textcolor{comment}{*\ \ \ \ \ Charles\ Romine,\ Henk\ van\ der\ Vorst,}}
\DoxyCodeLine{00241\ \textcolor{comment}{*\ \ \ \ \ Templates\ for\ the\ Solution\ of\ Linear\ Systems:}}
\DoxyCodeLine{00242\ \textcolor{comment}{*\ \ \ \ \ Building\ Blocks\ for\ Iterative\ Methods,}}
\DoxyCodeLine{00243\ \textcolor{comment}{*\ \ \ \ \ SIAM,\ 1994,}}
\DoxyCodeLine{00244\ \textcolor{comment}{*\ \ \ \ \ ISBN:\ 0898714710,}}
\DoxyCodeLine{00245\ \textcolor{comment}{*\ \ \ \ \ LC:\ QA297.8.T45.}}
\DoxyCodeLine{00246\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00247\ \textcolor{comment}{*\ \ \ Parameters:}}
\DoxyCodeLine{00248\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00249\ \textcolor{comment}{*\ \ \ \ \ Input,\ int\ N,\ the\ dimension\ of\ the\ matrix.}}
\DoxyCodeLine{00250\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00251\ \textcolor{comment}{*\ \ \ \ \ Input,\ double\ B[N],\ the\ right\ hand\ side\ vector.}}
\DoxyCodeLine{00252\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00253\ \textcolor{comment}{*\ \ \ \ \ Input/output,\ double\ X[N].\ \ On\ first\ call,\ the\ user\ }}
\DoxyCodeLine{00254\ \textcolor{comment}{*\ \ \ \ \ should\ store\ an\ initial\ guess\ for\ the\ solution\ in\ X.\ \ On\ return\ with}}
\DoxyCodeLine{00255\ \textcolor{comment}{*\ \ \ \ \ JOB\ =\ 4,\ X\ contains\ the\ latest\ solution\ estimate.}}
\DoxyCodeLine{00256\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00257\ \textcolor{comment}{*\ \ \ \ \ Input/output,\ double\ R[N],\ Z[N],\ P[N],\ Q[N],}}
\DoxyCodeLine{00258\ \textcolor{comment}{*\ \ \ \ \ information\ used\ by\ the\ program\ during\ the\ calculation.\ \ The\ user}}
\DoxyCodeLine{00259\ \textcolor{comment}{*\ \ \ \ \ does\ not\ need\ to\ initialize\ these\ vectors.\ \ However,\ specific}}
\DoxyCodeLine{00260\ \textcolor{comment}{*\ \ \ \ \ return\ values\ of\ JOB\ may\ require\ the\ user\ to\ carry\ out\ some\ computation}}
\DoxyCodeLine{00261\ \textcolor{comment}{*\ \ \ \ \ using\ data\ in\ some\ of\ these\ vectors.}}
\DoxyCodeLine{00262\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00263\ \textcolor{comment}{*\ \ \ \ \ Input/output,\ int\ JOB,\ communicates\ the\ task\ to\ be\ done.}}
\DoxyCodeLine{00264\ \textcolor{comment}{*\ \ \ \ \ The\ user\ needs\ to\ set\ the\ input\ value\ of\ JOB\ to\ 1,\ before\ the\ first\ call,}}
\DoxyCodeLine{00265\ \textcolor{comment}{*\ \ \ \ \ and\ then\ to\ 2\ for\ every\ subsequent\ call\ for\ the\ given\ problem.}}
\DoxyCodeLine{00266\ \textcolor{comment}{*\ \ \ \ \ The\ output\ value\ of\ JOB\ indicates\ the\ requested\ user\ action.\ \ }}
\DoxyCodeLine{00267\ \textcolor{comment}{*\ \ \ \ \ *\ JOB\ =\ 1,\ compute\ Q\ =\ A\ *\ P;}}
\DoxyCodeLine{00268\ \textcolor{comment}{*\ \ \ \ \ *\ JOB\ =\ 2:\ solve\ M*Z=R,\ where\ M\ is\ the\ preconditioning\ matrix;}}
\DoxyCodeLine{00269\ \textcolor{comment}{*\ \ \ \ \ *\ JOB\ =\ 3:\ compute\ R\ =\ R\ -\/\ A\ *\ X;}}
\DoxyCodeLine{00270\ \textcolor{comment}{*\ \ \ \ \ *\ JOB\ =\ 4:\ check\ the\ residual\ R\ for\ convergence.\ \ }}
\DoxyCodeLine{00271\ \textcolor{comment}{*\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ If\ satisfactory,\ terminate\ the\ iteration.}}
\DoxyCodeLine{00272\ \textcolor{comment}{*\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ If\ too\ many\ iterations\ were\ taken,\ terminate\ the\ iteration.}}
\DoxyCodeLine{00273\ \textcolor{comment}{*\ }}
\DoxyCodeLine{00274\ \textcolor{comment}{\ ===============================================================================================\ */}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \{}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keywordtype}{int}\ job\_next=0;}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordtype}{int}\ inc\ =1;}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordtype}{double}\ alpha,\ beta;}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{keywordtype}{double}\ a;}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordtype}{double}\ pdotq;}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00286\ \textcolor{comment}{\ \ \ Initialisation:\ ask\ user\ to\ compute\ the\ initial\ residual}}
\DoxyCodeLine{00287\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ job\ ==\ 1\ )\ \{}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ dcopy\_(\&n,\ b,\ \&inc,\ r,\ \&inc);}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ job\_next\ =\ 3;}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ rlbl\ =\ 2;}
\DoxyCodeLine{00294\ \ \ \ \ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00297\ \textcolor{comment}{\ \ \ Begin\ first\ conjugate\ gradient\ loop.\ Ask\ the\ user\ for\ a\ preconditioner\ solve}}
\DoxyCodeLine{00298\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ rlbl\ ==\ 2\ )\ \{}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ iter\ =\ 1;}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ job\_next\ =\ 2;}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ rlbl\ =\ 3;}
\DoxyCodeLine{00305\ \ \ \ \ \}}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00308\ \textcolor{comment}{\ \ \ Compute\ the\ direction;\ ask\ the\ user\ to\ compute\ ALPHA;\ save\ A*P\ to\ Q}}
\DoxyCodeLine{00309\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ rlbl\ ==\ 3\ )\ \{}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ rho\ =\ ddot\_(\&n,\ r,\ \&inc,\ z,\ \&inc);}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ 1\ <\ iter\ )\ \{}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ beta\ =\ rho\ /\ rho\_old;}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ daxpy\_(\&n,\ \&beta,\ p,\ \&inc,\ z,\ \&inc);}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ dcopy\_(\&n,\ z,\ \&inc,\ p,\ \&inc);}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ job\_next\ =\ 1;}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ rlbl\ =\ 4;}
\DoxyCodeLine{00325\ \ \ \ \ \}}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00328\ \textcolor{comment}{\ \ \ Compute\ current\ solution\ vector.\ Ask\ the\ user\ to\ check\ stopping\ criteria}}
\DoxyCodeLine{00329\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ rlbl\ ==\ 4\ )\ \{}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ pdotq\ =\ ddot\_(\&n,\ p,\ \&inc,\ q,\ \&inc);}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ alpha\ =\ rho\ /\ pdotq;}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ a\ =\ alpha;}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ daxpy\_(\&n,\ \&a,\ p,\ \&inc,\ x,\ \&inc);}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ a\ =\ -\/alpha;}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ daxpy\_(\&n,\ \&a,\ q,\ \&inc,\ r,\ \&inc);}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ job\_next\ =\ 4;}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ rlbl\ =\ 5;}
\DoxyCodeLine{00342\ \ \ \ \ \}}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00345\ \textcolor{comment}{\ \ \ Begin\ the\ next\ step;\ ask\ for\ a\ preconditioner\ solve}}
\DoxyCodeLine{00346\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ rlbl\ ==\ 5\ )}
\DoxyCodeLine{00349\ \ \ \ \ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ rho\_old\ =\ rho;}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ iter\ =\ iter\ +\ 1;}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ job\_next\ =\ 2;}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ rlbl\ =\ 3;}
\DoxyCodeLine{00355\ \ \ \ \ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{keywordflow}{return}\ job\_next;}
\DoxyCodeLine{00358\ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00361\ \textcolor{comment}{\ \ \ Conjugate\ gradient\ driver}}
\DoxyCodeLine{00362\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \ \textcolor{keywordtype}{int}\ ConjGradOT::cgDriver(\textcolor{keywordtype}{int}\ n1,\ \textcolor{keywordtype}{int}\ n2,\ \textcolor{keywordtype}{double}\ *D1,\ \textcolor{keywordtype}{double}\ *D2,\ \textcolor{keywordtype}{double}\ *G,\ \textcolor{keywordtype}{double}\ *B,\ \textcolor{keywordtype}{double}\ *X,}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ *r,\ \textcolor{keywordtype}{double}\ *z,\ \textcolor{keywordtype}{double}\ *p,\ \textcolor{keywordtype}{double}\ *q,\ \textcolor{keywordtype}{double}\ *Temp,\ \textcolor{keywordtype}{double}\ *Temp2,\ \textcolor{keywordtype}{double}\ tol)}
\DoxyCodeLine{00366\ \ \ \ \{}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{keywordtype}{int}\ it,\ it\_max;}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keywordtype}{int}\ job;}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordtype}{int}\ inc\ =\ 1;}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keywordtype}{int}\ n1pn2\ =\ n1\ +\ n2;}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordtype}{double}\ a;}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keywordtype}{double}\ bnrm2,\ rnrm2;}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{keywordtype}{double}\ *X\_old\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{double}[n1pn2];}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00379\ \textcolor{comment}{\ \ \ Set\ initial\ guess\ for\ the\ solution}}
\DoxyCodeLine{00380\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ memset(X,\ 0,\ n1pn2*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00383\ \ \ \ \ memset(r,\ 0,\ n1pn2*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00384\ \ \ \ \ memset(z,\ 0,\ n1pn2*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00385\ \ \ \ \ memset(p,\ 0,\ n1pn2*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00386\ \ \ \ \ memset(q,\ 0,\ n1pn2*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00389\ \textcolor{comment}{\ \ \ Parameters\ for\ the\ stopping\ test}}
\DoxyCodeLine{00390\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ it\ =\ 0;}
\DoxyCodeLine{00393\ \ \ \ \ it\_max\ =\ n1pn2;}
\DoxyCodeLine{00394\ \ \ \ \ it\_max\ =\ 100;}
\DoxyCodeLine{00395\ \ \ \ \ bnrm2\ =\ dnrm2\_(\&n1pn2,\ B,\ \&inc);}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \textcolor{comment}{/*\ ===============================================================================================}}
\DoxyCodeLine{00398\ \textcolor{comment}{\ \ \ Repeatedly\ call\ the\ cg\_rc\ code,\ and,\ on\ return,\ do\ what\ JOB\ tells\ us}}
\DoxyCodeLine{00399\ \textcolor{comment}{\ \ \ ===============================================================================================\ */}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ \ \ \ \ job\ =\ 1;}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keywordtype}{int}\ nm,\ npred;}
\DoxyCodeLine{00404\ \ \ \ \ nm\ =\ 0;}
\DoxyCodeLine{00405\ \ \ \ \ npred\ =\ 0;}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ dcopy\_(\&n1pn2,\ X,\ \&inc,\ X\_old,\ \&inc);}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ ;\ ;\ )}
\DoxyCodeLine{00410\ \ \ \ \ \{}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ job\ =\ cgRC\ (\ n1pn2,\ B,\ X,\ r,\ z,\ p,\ q,\ job\ );}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \textcolor{comment}{/*\ \ \ \ \ \ ==================================================================================}}
\DoxyCodeLine{00415\ \textcolor{comment}{\ \ \ \ \ \ \ \ Compute\ q\ =\ A\ *p}}
\DoxyCodeLine{00416\ \textcolor{comment}{\ \ \ \ \ \ \ \ ==================================================================================\ */}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ job\ ==\ 1\ )\ \{}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ computeMatVect(n1,\ n2,\ D1,\ D2,\ G,\ p,\ q,\ Temp);}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ nm++;}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \textcolor{comment}{/*\ \ \ \ \ \ ==================================================================================}}
\DoxyCodeLine{00424\ \textcolor{comment}{\ \ \ \ \ \ \ \ Preconditioning:\ solve\ M\ *\ z\ =\ r}}
\DoxyCodeLine{00425\ \textcolor{comment}{\ \ \ \ \ \ \ \ ==================================================================================\ */}}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ job\ ==\ 2\ )\ \{}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ preConditioner(n1,\ n2,\ D1,\ D2,\ G,\ r,\ z,\ Temp);}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ npred++;}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \textcolor{comment}{/*\ \ \ \ \ \ ==================================================================================}}
\DoxyCodeLine{00433\ \textcolor{comment}{\ \ \ \ \ \ \ \ Compute\ residual:\ r\ =\ r\ -\/\ A*x}}
\DoxyCodeLine{00434\ \textcolor{comment}{\ \ \ \ \ \ \ \ ==================================================================================\ */}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ job\ ==\ 3\ )\ \{}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ computeMatVect(n1,\ n2,\ D1,\ D2,\ G,\ X,\ Temp,\ Temp2);}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ nm++;}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ a\ =\ -\/1;}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ daxpy\_(\&n1pn2,\ \&a,\ Temp,\ \&inc,\ r,\ \&inc);}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \textcolor{comment}{/*\ \ \ \ \ \ ==================================================================================}}
\DoxyCodeLine{00446\ \textcolor{comment}{\ \ \ \ \ \ \ \ Stopping\ test\ on\ r}}
\DoxyCodeLine{00447\ \textcolor{comment}{\ \ \ \ \ \ \ \ ==================================================================================\ */}}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ job\ ==\ 4\ )\ \{}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ rnrm2\ =\ dnrm2\_(\&n1pn2,\ r,\ \&inc);}
\DoxyCodeLine{00452\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ std::cout\ <<\ "{}rnrm2\ =\ "{}\ <<\ rnrm2\ <<\ "{}\ bnrm2\ =\ "{}\ <<\ bnrm2\ <<\ "{}\ tol\ =\ "{}\ <<\ tol\ <<\ std::endl;}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ if\ (\ bnrm2\ ==\ 0.0\ )\ \{}}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ bnrm2\ <=\ 1.e-\/6\ )\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ rnrm2\ <=\ tol\ )\ \{}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ rnrm2\ <=\ tol\ *\ bnrm2\ )\ \{}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ it\ =\ it\ +\ 1;}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(it\ >\ it\_max)\ \{}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ job\ =\ 2;}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \}}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{keywordflow}{return}\ it;}
\DoxyCodeLine{00478\ \ \ }
\DoxyCodeLine{00479\ \ \ \}}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
